<!DOCTYPE HTML>
<html lang="fr">
	<head>
		<title>Modular Greek Architecture Calculator - Alexandre ZANNI</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
	</head>
		<h1>Calculateur de modules pour l'architecture grecque (Work in Progress)</h1>
		<h3> Exemples d'unités de mesures antiques :</h3>

		<table style="border: 1px solid black">
		  <tr>
		    <th>Culture</th>
		    <th>Type</th>
		    <th>Valeur moyenne (m)</th>
		  </tr>
		  <tr>
		    <td>Punique</td>
		    <td>Coudée / Cubit</td>
		    <td>0.516</td>
		  </tr>
		  <tr>
		    <td>Punique</td>
		    <td>Pied</td>
		    <td>0.3436</td>
		  </tr>
			<tr>
				<td>Romain</td>
				<td>Pied</td>
				<td>0.295</td>
			</tr>
		</table>

		</br></br>

		</br></br>
		<button onclick="calculateModularity()">GENERER CALCUL MODULES</button>
		</br></br>
		<h2>Résultat :</h2> <span id="spanResult"><h3>...</h3></span></br></br>
		<span id="summary"><h3></h3></span>

		</br></br>
		<h2> Remplir les champs ci-dessous avant de cliquer sur "GENERER CALCUL MODULES" :</h2>
		<span id="spanSaisir"><h3>Référence principale :</h3></span>

				<span id="errorMessage" style="font-weight: bold;"><h3></h3></span></br>

				Longueur édifice : <input type="text" id="inputLength" placeholder="8.40" size="100" title="Type in a length/height">
				</br>
				Largeur édifice : <input type="text" id="inputWidth" placeholder="4.60" size="100" title="Type in a width">
				</br>
				Valeur d'un pied en mètres : <input type="text" id="inputUnitValue" placeholder="0.3436" size="100" title="Type in a unit value">
				</br>

		</br></br>

			<script>

			function calculateModularity()
			{
			  var textLength = document.getElementById("inputLength").value; // 8.40
				var textWidth = document.getElementById("inputWidth").value; // 4.60
				var textUnitValue = document.getElementById("inputUnitValue").value;  // 0.3436;
				var feetUnitLengthCount = Math.round(textLength/textUnitValue);
				var feetUnitWidthCount = Math.round(textWidth/textUnitValue);

				if (!textLength || !textWidth || !textUnitValue)
				{
					writeErrorMessage("ATTENTION : Tous les champs doivent être remplis avant calcul");
					writeResultMessage('');
					writeSummaryMessage('');
				} else {
					writeErrorMessage('');

					var ratioLengthWidth = textLength/textWidth;
					var roundedRatioLengthWidth = ratioLengthWidth.toFixed(1);
					var fractionFromFloat = calculateFractionFromFloat(roundedRatioLengthWidth);
					var numberOfSquareByBuildingSide = calculateNumberOfSquareByBuildingSide(textLength, textWidth);

					var modulo1 = (feetUnitLengthCount / numberOfSquareByBuildingSide[0]).toFixed(1);
					var modulo2 = (feetUnitWidthCount / numberOfSquareByBuildingSide[1]).toFixed(1);

					writeResultMessage(
						"Nombre de pieds / longueur = " + feetUnitLengthCount + " ; "
					+ "Nombre de pieds / largeur = " + feetUnitWidthCount + " ; "
					+ "Ratio arrondi (1 chiffre) longueur / largeur = " + roundedRatioLengthWidth + " ; "
					+ "Fraction du ratio longueur / largeur = " + fractionFromFloat + " ; "
					+ "Longueur et largeur nombre de cases de la grille = " + numberOfSquareByBuildingSide.join(" & ") + " ; "
				  + "Valeur d'un module = " + modulo1 + " = " + modulo2 + " ; "
					);

					writeSummaryMessage(
						"BILAN : " + feetUnitLengthCount + ' PIEDS pour ' + numberOfSquareByBuildingSide[0] + ' CASES '
					+ "et : " + feetUnitWidthCount + ' PIEDS pour ' + numberOfSquareByBuildingSide[1] + ' CASES' + " ; "
					+ "pour UN MODULE DE : " + modulo1 + ' = ' + modulo2 + ' PIEDS PAR CASE' + " ; "
					);
				}
			}

			function writeResultMessage(result)
			{
				document.getElementById("spanResult").textContent = result;
			}

			function writeSummaryMessage(summary)
			{
				document.getElementById("summary").textContent = summary;
			}

			function writeErrorMessage(errorMessage)
			{
				document.getElementById("errorMessage").textContent = errorMessage;
			}

			function calculateNumberOfSquareByBuildingSide(textLength, textWidth) {
				var squareNumbersLengthArray = [];
				var squareNumbersWidthArray = [];
				var ratioLength = 1;
				var ratioWidth = 1;

				for (var i = 1; i <= 100; i++)
				{
					ratioLength = textLength/i;
					ratioWidth = textWidth/i;
					squareNumbersLengthArray.push(ratioLength);
					squareNumbersWidthArray.push(ratioWidth);
				}

				var commonValues = [];
				var hasAtLeastOneCommonValue = false;
				var needAnotherTurn = false;
				for (var j = 0; j < squareNumbersLengthArray.length; j++)
				{
						var currentElement = squareNumbersLengthArray[j].toFixed(2);
						if (squareNumbersWidthArray.includes(currentElement))
						{
								hasAtLeastOneCommonValue = true;
								commonValues.push(currentElement);
								break;
						}
				}

				if (hasAtLeastOneCommonValue == false)
				{
					needAnotherTurn = true;
					var roundedSquareNumbersWidthArray = [];
					var roundedSquareNumbersLengthArray = [];
					var currentElementK = 0;
					var currentElementKk = 0;
					var currentElementL = 0;
					for (var k = 0; k < squareNumbersWidthArray.length; k++)
					{
							currentElementK = roundingTwoNumbersAfterComma(squareNumbersWidthArray[k]);
							roundedSquareNumbersWidthArray.push(currentElementK);
					}

					for (var kk = 0; kk < squareNumbersLengthArray.length; kk++)
					{
							currentElementKk = roundingTwoNumbersAfterComma(squareNumbersLengthArray[kk]);
							roundedSquareNumbersLengthArray.push(currentElementKk);
					}

					for (var l = 0; l < squareNumbersLengthArray.length; l++)
					{
							currentElementL = roundingTwoNumbersAfterComma(squareNumbersLengthArray[l]);
							if (roundedSquareNumbersWidthArray.includes(currentElementL))
							{
									hasAtLeastOneCommonValue = true;
									commonValues.push(currentElementL);
									break;
							}
					}
				}

				var indexLength = 0;
				var indexWidth = 0;

				if (needAnotherTurn) {
					indexLength = roundedSquareNumbersLengthArray.indexOf(commonValues[0]) + 1;
					indexWidth = roundedSquareNumbersWidthArray.indexOf(commonValues[0]) + 1;
				} else {
					indexLength = squareNumbersLengthArray.indexOf(commonValues[0]) + 1;
					indexWidth = squareNumbersWidthArray.indexOf(commonValues[0]) + 1;
				}

				if (indexLength == -1)
				{
					indexLength = i;
				}
				if (indexWidth == -1)
				{
					indexWidth = i
				}

				return [indexLength, indexWidth];
			}

			function roundingTwoNumbersAfterComma(currentNumber)
			{
				var strNumber = String(currentNumber).slice(0, 4);
				var realNumber = Number(strNumber);
				return realNumber;
			}

			function calculateFractionFromFloat(ratioLengthWidth)
			{
				var gcd = function(a, b) {
				  if (!b) return a;
				  return gcd(b, a % b);
				};

				var fraction = ratioLengthWidth;
				var len = fraction.toString().length - 2;

				var denominator = Math.pow(10, len);
				var numerator = fraction * denominator;

				var divisor = gcd(numerator, denominator);

				numerator /= divisor;
				denominator /= divisor;

				var normalizedFraction = (Math.floor(numerator) + '/' + Math.floor(denominator));
				return normalizedFraction;
			}

		</script>

	</body>
</html>
