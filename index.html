<!DOCTYPE HTML>
<html lang="fr">
	<head>
		<title>Modular Greek Architecture Calculator - Alexandre ZANNI</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
	</head>
	<style>
		.grid-container {
			display: grid;
			grid-auto-rows: 1fr;
			background: url('temple_b_selinus.png');
			background-size: contain;
			background-repeat: no-repeat;
		}
		.grid-container > div::before {
		  content: "";
			display: block;
		  padding-top: 100%;
		}
		.grid-item {
		  background-color: rgba(255, 255, 255, 0.8);
		  border: 1px solid rgba(0, 0, 0, 0.8);
		  padding: 20px;
		  font-size: 30px;
		  text-align: center;
		}
	</style>
		<h1>Calculateur de modules pour l'architecture grecque (Work in Progress)</h1>
		<h3> Exemples d'unités de mesures antiques :</h3> (Coudée/cubit punique = 0.516 m ; 7 pieds romain = 4 cubit punique ; 1 coudée romaine = 1.5 pied romain ; Coudée royale égyptienne (datation ?) : 0.5245 m)

		<table style="border: 1px solid black">
		  <tr>
		    <th>Culture</th>
		    <th>Type</th>
		    <th>Valeur moyenne (m)</th>
		  </tr>
			<tr>
				<td>Romain</td>
				<td>Pied</td>
				<td>0.2950</td>
			</tr>
		  <tr>
		    <td>Samos</td>
		    <td>Pied</td>
		    <td>0.3040</td>
		  </tr>
			<tr>
				<td>Dorique</td>
				<td>Pied</td>
				<td>0.3270</td>
			</tr>
			<tr>
				<td>Punique (Leptis Magna)</td>
				<td>Pied</td>
				<td>0.3436</td>
			</tr>
			<tr>
				<td>Ionique</td>
				<td>Pied</td>
				<td>0.3490</td>
			</tr>
		</table>

		</br></br>

		</br></br>
		<button onclick="calculateModularity()">GENERER CALCUL MODULES</button>
		</br></br>
		<h2>Résultat :</h2>
		<span id="errorMessage" style="font-weight: bold;"><h3></h3></span>
		<span id="spanResult"><h3>...</h3></span></br></br>
		<span id="detailCalculation"><h3></h3></span></br></br>
		<span id="moreDetailCalculationLength"><h3></h3></span></br></br>
		<span id="moreDetailCalculationWidth"><h3></h3></span></br></br>
		<span id="summary"><h3></h3></span>

		</br></br>
		<h2> Remplir les champs ci-dessous avant de cliquer sur "GENERER CALCUL MODULES" :</h2>
		<span id="spanSaisir"><h3>Référence principale :</h3></span>

				Longueur édifice : <input type="text" id="inputLength" placeholder="8.40" size="100" title="Type in a length/height">
				</br>
				Largeur édifice : <input type="text" id="inputWidth" placeholder="4.60" size="100" title="Type in a width">
				</br>
				Valeur d'un pied en mètres : <input type="text" id="inputUnitValue" placeholder="0.3436" size="100" title="Type in a unit value">
				</br>
				Arrondi après la virgule : <select id="selectRounding">
																		<option value="1">1</option>
																		<option value="2">2</option>
																		<option value="3">3</option>
																	</select>
				</br>
				Nombre cases minimum largeur (influe sur taille module) : <select id="selectSizeModulo">
																		<option value="2">2</option>
																		<option value="4">4</option>
																		<option value="6">6</option>
																		<option value="8">8</option>
																		<option value="10">10</option>
																	</select>
				</br>

		</br></br>

		<div class="grid-container" id="grid-container" style="width: 25%; height: 25%;"></div>
		</br></br>

			<script>

			function calculateModularity()
			{
			  var textLength = document.getElementById("inputLength").value; // 8.40
				// textLength = 24;

				var textWidth = document.getElementById("inputWidth").value; // 4.60
				// textWidth = 9.60;

				var textUnitValue = document.getElementById("inputUnitValue").value;  // 0.3436;
				// textUnitValue = 0.3436;

				var selectRounding = document.getElementById("selectRounding").value; // 1

				var selectSizeModulo = document.getElementById("selectSizeModulo").value; // 2

				var feetUnitLengthCount = Math.round(textLength/textUnitValue);
				var feetUnitWidthCount = Math.round(textWidth/textUnitValue);

				if (!textLength || !textWidth || !textUnitValue)
				{
					writeErrorMessage("ATTENTION : Tous les champs doivent être remplis avant calcul");
					writeResultMessage('');
					writeDetailCalculation('');
					writeMoreDetailCalculationLength(false);
					writeMoreDetailCalculationWidth(false);
					writeSummaryMessage('');
				} else if (textWidth > textLength)
				{
					writeErrorMessage("ATTENTION : La longueur doit être supérieure à la largeur");
				} else {
					writeErrorMessage('');

					var ratioLengthWidth = textLength/textWidth;
					var roundedRatioLengthWidth = ratioLengthWidth.toFixed(selectRounding);
					var fractionFromFloat = calculateFractionFromFloat(roundedRatioLengthWidth);
					var numberOfSquareByBuildingSide = calculateNumberOfSquareByBuildingSide(textLength, textWidth, selectRounding, selectSizeModulo);
					var commonValueLengthWidth = numberOfSquareByBuildingSide[4];

					var modulo1 = (feetUnitLengthCount / numberOfSquareByBuildingSide[0]).toFixed(selectRounding);
					var modulo2 = (feetUnitWidthCount / numberOfSquareByBuildingSide[1]).toFixed(selectRounding);


					// ----------------------------------------------------------
					var ratioLongueurTableau = [];
					var ratioLargeurTableau = [];
					ratioLongueurTableau = numberOfSquareByBuildingSide[2];
					ratioLargeurTableau = numberOfSquareByBuildingSide[3];
					// ----------------------------------------------------------

					writeResultMessage(
						"DONNEES : "
					+	"NLO = Nombre pieds / longueur = " + feetUnitLengthCount + " ; "
					+ "NLA = Nombre pieds / largeur = " + feetUnitWidthCount + " ; "
					+ "RATL = Ratio arrondi (" + selectRounding + " chiffre) longueur / largeur = " + roundedRatioLengthWidth + " ; "
					+ "FLL = Fraction ratio longueur / largeur = " + fractionFromFloat + " ; "
					+ "Longueur & largeur nombre de cases de la grille = " + numberOfSquareByBuildingSide[0] + " & " + numberOfSquareByBuildingSide[1] + " ; "
				  + "Valeur d'un module arrondi (" + selectRounding + " chiffre) : M1 = " + modulo1 + " (LONGUEUR) & M2 = " + modulo2 + " (LARGEUR) ; "
					);

					writeDetailCalculation(
						"DETAIL CALCULS : "
					+	"NLO = Arrondi(" + textLength + " / " + textUnitValue + ") ; "
					+	"NLA = Arrondi(" + textWidth + " / " + textUnitValue + ") ; "
					+ "RATL = Arrondi(" + textLength + " / " + textWidth + ") ; "
					+ "FLL = Fraction(" + roundedRatioLengthWidth + ") ; "
					+ "M1 = NLO / Nombre cases pour Longueur = " + feetUnitLengthCount + " / " +  numberOfSquareByBuildingSide[0] +  ") ; "
					+ "M2 = NLA / Nombre cases pour Largeur = " + feetUnitWidthCount + " / " + numberOfSquareByBuildingSide[1] +  ")"
					);

					var removeBeforeLength = removeAllAfterArrayValue(ratioLongueurTableau, commonValueLengthWidth).join(", ");
					var removeAfterLength = removeAllBeforeArrayValue(ratioLongueurTableau, commonValueLengthWidth).slice(1).join(", ");

					writeMoreDetailCalculationLength(true, removeBeforeLength, commonValueLengthWidth, removeAfterLength);

					var removeBeforeWidth = removeAllAfterArrayValue(ratioLargeurTableau, commonValueLengthWidth).join(", ");
					var removeAfterWidth = removeAllBeforeArrayValue(ratioLargeurTableau, commonValueLengthWidth).slice(1).join(", ");

					writeMoreDetailCalculationWidth(true, removeBeforeWidth, commonValueLengthWidth, removeAfterWidth);

					writeSummaryMessage(
						"BILAN : "
					+ feetUnitLengthCount + ' PIEDS pour ' + numberOfSquareByBuildingSide[0] + ' CASES (LONGUEUR) '
					+ "et : " + feetUnitWidthCount + ' PIEDS pour ' + numberOfSquareByBuildingSide[1] + ' CASES (LARGEUR)' + " ; "
					+ "pour UN MODULE DE : " + modulo1 + ' (LONGUEUR) = ' + modulo2 + ' (LARGEUR) PIEDS ( ' + modulo1*textUnitValue + ' / ' + modulo2*textUnitValue + ' m) PAR CASE' + " ; "
					);

					createGridModulo(numberOfSquareByBuildingSide[0], numberOfSquareByBuildingSide[1]);
				}
			}

			function removeAllBeforeArrayValue(wholeArray, number) {
			  var position = wholeArray.indexOf(number);
			  if(position === -1) // not found
			    return wholeArray;
			  return wholeArray.slice(position);
			}

			function removeAllAfterArrayValue(wholeArray, number) {
				var arrayBefore = removeAllBeforeArrayValue(wholeArray, number);
				var differenceTwoArrays = wholeArray.filter(x => !arrayBefore.includes(x));
				return differenceTwoArrays;
			}

			function writeResultMessage(result)
			{
				document.getElementById("spanResult").textContent = result;
			}

			function writeDetailCalculation(detail)
			{
				document.getElementById("detailCalculation").textContent = detail;
			}

			function writeMoreDetailCalculationLength(isFilled, removeBeforeLength, commonValueLengthWidth, removeAfterLength)
			{
				var  coloredRatioLength = document.getElementById("moreDetailCalculationLength");
				if (isFilled) {
					coloredRatioLength.innerHTML = "Longueur / valeurs [1-40] (Toujours arrondi au 10ème) : " + removeBeforeLength +  ", " + "<span style='color:red;font-weight: bold;'>"+ commonValueLengthWidth +"</span>" + ", " + removeAfterLength;
				} else{
					coloredRatioLength.innerHTML = '';
				}
			}

			function writeMoreDetailCalculationWidth(isFilled, removeBeforeWidth, commonValueLengthWidth, removeAfterWidth)
			{
				var  coloredRatioWidth = document.getElementById("moreDetailCalculationWidth");
				if (isFilled) {
					coloredRatioWidth.innerHTML = "Largeur / valeurs [1-40] (Toujours arrondi au 10ème) : " + removeBeforeWidth +  ", " + "<span style='color:red;font-weight: bold;'>"+ commonValueLengthWidth +"</span>" +  ", "+ removeAfterWidth;
				} else {
					coloredRatioWidth.innerHTML = '';
				}
			}

			function writeSummaryMessage(summary)
			{
				document.getElementById("summary").textContent = summary;
			}

			function writeErrorMessage(errorMessage)
			{
				document.getElementById("errorMessage").textContent = errorMessage;
			}

			function calculateNumberOfSquareByBuildingSide(textLength, textWidth, selectRounding, selectSizeModulo) {
				var squareNumbersLengthArray = [];
				var squareNumbersWidthArray = [];
				var ratioLength = 1;
				var ratioWidth = 1;

				for (var i = 1; i <= 40; i++)
				{
					ratioLength = textLength/i;
					ratioWidth = textWidth/i;
					squareNumbersLengthArray.push(ratioLength);
					squareNumbersWidthArray.push(ratioWidth);
				}

				var commonValues = [];

				var roundedSquareNumbersWidthArray = [];
				var roundedSquareNumbersLengthArray = [];
				var currentElementK = 0;
				var currentElementKk = 0;
				var currentElementL = 0;
				for (var k = 0; k < squareNumbersWidthArray.length; k++)
				{
						currentElementK = roundingOneNumberAfterComma(squareNumbersWidthArray[k], selectRounding);
						roundedSquareNumbersWidthArray.push(currentElementK);
				}

				for (var kk = 0; kk < squareNumbersLengthArray.length; kk++)
				{
						currentElementKk = roundingOneNumberAfterComma(squareNumbersLengthArray[kk], selectRounding);
						roundedSquareNumbersLengthArray.push(currentElementKk);
				}

				var indexLength = 0;
				var indexWidth = 0;
				for (var l = 0; l < squareNumbersLengthArray.length; l++)
				{
						currentElementL = roundingOneNumberAfterComma(squareNumbersLengthArray[l], selectRounding);
						indexCurrentWidth = roundedSquareNumbersWidthArray.indexOf(currentElementL) + 1;
						if (roundedSquareNumbersWidthArray.includes(currentElementL) && indexCurrentWidth >= selectSizeModulo)
						{
								commonValues.push(currentElementL);
								break;
						}
				}

				indexLength = roundedSquareNumbersLengthArray.indexOf(commonValues[0]) + 1;
				indexWidth = roundedSquareNumbersWidthArray.indexOf(commonValues[0]) + 1;

				if (indexLength == -1)
				{
					indexLength = i;
				}
				if (indexWidth == -1)
				{
					indexWidth = i
				}

				return [indexLength, indexWidth, roundedSquareNumbersLengthArray, roundedSquareNumbersWidthArray, commonValues[0]];
			}

			function roundingOneNumberAfterComma(currentNumber, selectRounding)
			{
				var strNumber = String(currentNumber).slice(0, 4); // EXTRAIT 3 CHIFFRES APRES VIRGULES
				var realNumber = Number(strNumber);
				return round(realNumber, 1); // ARRONDI CONSTANT 1 CHIFFRE APRES VIGULE
			}

			function round(value, precision) {
			    var multiplier = Math.pow(10, precision || 0);
			    return Math.round(value * multiplier) / multiplier;
			}

			function calculateFractionFromFloat(ratioLengthWidth)
			{
				var gcd = function(a, b) {
				  if (!b) return a;
				  return gcd(b, a % b);
				};

				var fraction = ratioLengthWidth;
				var len = fraction.toString().length - 2;

				var denominator = Math.pow(10, len);
				var numerator = fraction * denominator;

				var divisor = gcd(numerator, denominator);

				numerator /= divisor;
				denominator /= divisor;

				var normalizedFraction = (Math.floor(numerator) + '/' + Math.floor(denominator));
				return normalizedFraction;
			}

			function createGridModulo(numberModuloLength, numberModuloWidth)
			{
				var numberModulo = numberModuloLength*numberModuloWidth;

				// var img_default_copy =  document.getElementById('img');
				var table = document.getElementById('grid-container');
				var gridTemplateColumns = 'grid-template-columns';
				table.style.gridTemplateColumns = "repeat("+numberModuloWidth+", 1fr)";
				table.style.background = "url('temple_b_selinus.png') contain";
				table.innerHTML = "";
				squares = [];
				var square = document.createElement('div');
				square.classList.add("grid-item");

				for (var m = 1; m <= numberModulo; m++) {
						var square = document.createElement('div');
						square.classList.add("grid-item");
						squares.push(square);
				}
;
				for (var n = 0; n < squares.length; n++) {
					table.appendChild(squares[n]);
				}
			}

		</script>

	</body>
</html>
