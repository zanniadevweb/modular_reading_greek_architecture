<!DOCTYPE HTML>
<html lang="fr">
	<head>
		<title>Modular Greek Architecture Calculator - Alexandre ZANNI</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
	</head>
	<style>
		.grid-container {
		  display: grid;
		  grid-template-columns: auto auto auto;
		  background-color: #2196F3;
		  padding: 10px;
		}
		/* padding-bottom: 100%;
		display: block; */
		.grid-container > div::before {
		  content: "";
		}
		.grid-item {
		  background-color: rgba(255, 255, 255, 0.8);
		  border: 1px solid rgba(0, 0, 0, 0.8);
		  padding: 20px;
		  font-size: 30px;
		  text-align: center;
		}
	</style>
		<h1>Calculateur de modules pour l'architecture grecque (Work in Progress)</h1>
		<h3> Exemples d'unités de mesures antiques :</h3> (Coudée/cubit punique = 0.516 m ; 7 pieds romain = 4 cubit punique ; 1 coudée romaine = 1.5 pied romain ; Coudée royale égyptienne (datation ?) : 0.5245 m)

		<table style="border: 1px solid black">
		  <tr>
		    <th>Culture</th>
		    <th>Type</th>
		    <th>Valeur moyenne (m)</th>
		  </tr>
			<tr>
				<td>Romain</td>
				<td>Pied</td>
				<td>0.2950</td>
			</tr>
		  <tr>
		    <td>Samos</td>
		    <td>Pied</td>
		    <td>0.3040</td>
		  </tr>
			<tr>
				<td>Dorique</td>
				<td>Pied</td>
				<td>0.3270</td>
			</tr>
			<tr>
				<td>Punique (Leptis Magna)</td>
				<td>Pied</td>
				<td>0.3436</td>
			</tr>
			<tr>
				<td>Ionique</td>
				<td>Pied</td>
				<td>0.3490</td>
			</tr>
		</table>

		</br></br>

		</br></br>
		<button onclick="calculateModularity()">GENERER CALCUL MODULES</button>
		</br></br>
		<h2>Résultat :</h2>
		<span id="errorMessage" style="font-weight: bold;"><h3></h3></span>
		<span id="spanResult"><h3>...</h3></span></br></br>
		<span id="detailCalculation"><h3></h3></span></br></br>
		<span id="moreDetailCalculationLength"><h3></h3></span></br></br>
		<span id="moreDetailCalculationWidth"><h3></h3></span></br></br>
		<span id="summary"><h3></h3></span>

		</br></br>
		<h2> Remplir les champs ci-dessous avant de cliquer sur "GENERER CALCUL MODULES" :</h2>
		<span id="spanSaisir"><h3>Référence principale :</h3></span>

				Longueur édifice : <input type="text" id="inputLength" placeholder="8.40" size="100" title="Type in a length/height">
				</br>
				Largeur édifice : <input type="text" id="inputWidth" placeholder="4.60" size="100" title="Type in a width">
				</br>
				Valeur d'un pied en mètres : <input type="text" id="inputUnitValue" placeholder="0.3436" size="100" title="Type in a unit value">
				</br>

		</br></br>

		<div class="grid-container" id="grid-container" style="width: 25%; height: 25%;"><img id="img" src="temple_b_selinus.png"></div>

			<script>

			function calculateModularity()
			{
			  var textLength = document.getElementById("inputLength").value; // 8.40
				textLength = 8.40;
				var textWidth = document.getElementById("inputWidth").value; // 4.60
				textWidth = 4.60;
				var textUnitValue = document.getElementById("inputUnitValue").value;  // 0.3436;
				textUnitValue = 0.3436;
				var feetUnitLengthCount = Math.round(textLength/textUnitValue);
				var feetUnitWidthCount = Math.round(textWidth/textUnitValue);

				if (!textLength || !textWidth || !textUnitValue)
				{
					writeErrorMessage("ATTENTION : Tous les champs doivent être remplis avant calcul");
					writeResultMessage('');
					writeDetailCalculation('');
					writeMoreDetailCalculationLength('');
					writeMoreDetailCalculationWidth('');
					writeSummaryMessage('');
				} else {
					writeErrorMessage('');

					var ratioLengthWidth = textLength/textWidth;
					var roundedRatioLengthWidth = ratioLengthWidth.toFixed(1);
					var fractionFromFloat = calculateFractionFromFloat(roundedRatioLengthWidth);
					var numberOfSquareByBuildingSide = calculateNumberOfSquareByBuildingSide(textLength, textWidth);

					var modulo1 = (feetUnitLengthCount / numberOfSquareByBuildingSide[0]).toFixed(1);
					var modulo2 = (feetUnitWidthCount / numberOfSquareByBuildingSide[1]).toFixed(1);


					// ----------------------------------------------------------
					var besoinAutreTour = numberOfSquareByBuildingSide[2];
					var ratioLongueurTableau = [];
					var ratioLargeurTableau = [];
					if (besoinAutreTour)
					{
						ratioLongueurTableau = numberOfSquareByBuildingSide[3];
						ratioLargeurTableau = numberOfSquareByBuildingSide[4];
					} else {
						ratioLongueurTableau = numberOfSquareByBuildingSide[5];
						ratioLargeurTableau = numberOfSquareByBuildingSide[6];
					}
					// ----------------------------------------------------------

					writeResultMessage(
						"DONNEES : "
					+	"NLO = Nombre pieds / longueur = " + feetUnitLengthCount + " ; "
					+ "NLA = Nombre pieds / largeur = " + feetUnitWidthCount + " ; "
					+ "RATL = Ratio arrondi (1 chiffre) longueur / largeur = " + roundedRatioLengthWidth + " ; "
					+ "FLL = Fraction ratio longueur / largeur = " + fractionFromFloat + " ; "
					+ "Longueur & largeur nombre de cases de la grille = " + numberOfSquareByBuildingSide[0] + " & " + numberOfSquareByBuildingSide[1] + " ; "
				  + "Valeur d'un module arrondi (1 chiffre) : M1 = " + modulo1 + " (LONGUEUR) & M2 = " + modulo2 + " (LARGEUR) ; "
					);

					writeDetailCalculation(
						"DETAIL CALCULS : "
					+	"NLO = Arrondi(" + textLength + " / " + textUnitValue + ") ; "
					+	"NLA = Arrondi(" + textWidth + " / " + textUnitValue + ") ; "
					+ "RATL = Arrondi(" + textLength + " / " + textWidth + ") ; "
					+ "FLL = Fraction(" + roundedRatioLengthWidth + ") ; "
					+ "M1 = NLO / Nombre cases pour Longueur = " + feetUnitLengthCount + " / " +  numberOfSquareByBuildingSide[0] +  ") ; "
					+ "M2 = NLA / Nombre cases pour Largeur = " + feetUnitWidthCount + " / " + numberOfSquareByBuildingSide[1] +  ")"
					);

					writeMoreDetailCalculationLength(
						"Longueur divisée par valeurs [1-100] : " + ratioLongueurTableau.join(", ")
					);

					writeMoreDetailCalculationWidth(
						"Largeur divisée par valeurs [1-100] : " + ratioLargeurTableau.join(", ")
					);

					writeSummaryMessage(
						"BILAN : "
					+ feetUnitLengthCount + ' PIEDS pour ' + numberOfSquareByBuildingSide[0] + ' CASES (LONGUEUR) '
					+ "et : " + feetUnitWidthCount + ' PIEDS pour ' + numberOfSquareByBuildingSide[1] + ' CASES (LARGEUR)' + " ; "
					+ "pour UN MODULE DE : " + modulo1 + ' (LONGUEUR) = ' + modulo2 + ' (LARGEUR) PIEDS PAR CASE' + " ; "
					);

					createGridModulo(numberOfSquareByBuildingSide[0], numberOfSquareByBuildingSide[1]);
				}
			}

			function writeResultMessage(result)
			{
				document.getElementById("spanResult").textContent = result;
			}

			function writeDetailCalculation(detail)
			{
				document.getElementById("detailCalculation").textContent = detail;
			}

			function writeMoreDetailCalculationLength(moreDetailLength)
			{
				document.getElementById("moreDetailCalculationLength").textContent = moreDetailLength;
			}

			function writeMoreDetailCalculationWidth(moreDetailWidth)
			{
				document.getElementById("moreDetailCalculationWidth").textContent = moreDetailWidth;
			}

			function writeSummaryMessage(summary)
			{
				document.getElementById("summary").textContent = summary;
			}

			function writeErrorMessage(errorMessage)
			{
				document.getElementById("errorMessage").textContent = errorMessage;
			}

			function calculateNumberOfSquareByBuildingSide(textLength, textWidth) {
				var squareNumbersLengthArray = [];
				var squareNumbersWidthArray = [];
				var ratioLength = 1;
				var ratioWidth = 1;

				for (var i = 1; i <= 100; i++)
				{
					ratioLength = textLength/i;
					ratioWidth = textWidth/i;
					squareNumbersLengthArray.push(ratioLength);
					squareNumbersWidthArray.push(ratioWidth);
				}

				var commonValues = [];
				var hasAtLeastOneCommonValue = false;
				var needAnotherTurn = false;
				for (var j = 0; j < squareNumbersLengthArray.length; j++)
				{
						var currentElement = squareNumbersLengthArray[j].toFixed(2);
						if (squareNumbersWidthArray.includes(currentElement))
						{
								hasAtLeastOneCommonValue = true;
								commonValues.push(currentElement);
								break;
						}
				}

				if (hasAtLeastOneCommonValue == false)
				{
					needAnotherTurn = true;
					var roundedSquareNumbersWidthArray = [];
					var roundedSquareNumbersLengthArray = [];
					var currentElementK = 0;
					var currentElementKk = 0;
					var currentElementL = 0;
					for (var k = 0; k < squareNumbersWidthArray.length; k++)
					{
							currentElementK = roundingTwoNumbersAfterComma(squareNumbersWidthArray[k]);
							roundedSquareNumbersWidthArray.push(currentElementK);
					}

					for (var kk = 0; kk < squareNumbersLengthArray.length; kk++)
					{
							currentElementKk = roundingTwoNumbersAfterComma(squareNumbersLengthArray[kk]);
							roundedSquareNumbersLengthArray.push(currentElementKk);
					}

					for (var l = 0; l < squareNumbersLengthArray.length; l++)
					{
							currentElementL = roundingTwoNumbersAfterComma(squareNumbersLengthArray[l]);
							if (roundedSquareNumbersWidthArray.includes(currentElementL))
							{
									hasAtLeastOneCommonValue = true;
									commonValues.push(currentElementL);
									break;
							}
					}
				}

				var indexLength = 0;
				var indexWidth = 0;

				if (needAnotherTurn) {
					indexLength = roundedSquareNumbersLengthArray.indexOf(commonValues[0]) + 1;
					indexWidth = roundedSquareNumbersWidthArray.indexOf(commonValues[0]) + 1;
				} else {
					indexLength = squareNumbersLengthArray.indexOf(commonValues[0]) + 1;
					indexWidth = squareNumbersWidthArray.indexOf(commonValues[0]) + 1;
				}

				if (indexLength == -1)
				{
					indexLength = i;
				}
				if (indexWidth == -1)
				{
					indexWidth = i
				}

				return [indexLength, indexWidth, needAnotherTurn, roundedSquareNumbersLengthArray, roundedSquareNumbersWidthArray, squareNumbersLengthArray, squareNumbersWidthArray];
			}

			function roundingTwoNumbersAfterComma(currentNumber)
			{
				var strNumber = String(currentNumber).slice(0, 4);
				var realNumber = Number(strNumber);
				return round(realNumber, 1);
			}

			function round(value, precision) {
			    var multiplier = Math.pow(10, precision || 0);
			    return Math.round(value * multiplier) / multiplier;
			}

			function calculateFractionFromFloat(ratioLengthWidth)
			{
				var gcd = function(a, b) {
				  if (!b) return a;
				  return gcd(b, a % b);
				};

				var fraction = ratioLengthWidth;
				var len = fraction.toString().length - 2;

				var denominator = Math.pow(10, len);
				var numerator = fraction * denominator;

				var divisor = gcd(numerator, denominator);

				numerator /= divisor;
				denominator /= divisor;

				var normalizedFraction = (Math.floor(numerator) + '/' + Math.floor(denominator));
				return normalizedFraction;
			}

			function createGridModulo(numberModuloLength, numberModuloWidth)
			{
				var numberModulo = numberModuloLength*numberModuloWidth;

				var img_default_copy =  document.getElementById('img');
				var table = document.getElementById('grid-container');
				table.innerHTML = "";
				squares = [];
				var square = document.createElement('div');
				square.classList.add("grid-item");

				for (var m = 1; m < numberModulo; m++) {
						var square = document.createElement('div');
						square.classList.add("grid-item");
						squares.push(square);
				}

				// table.appendChild(img_default_copy);
				for (var n = 1; n < squares.length; n++) {
					table.appendChild(squares[n]);
				}
			}

		</script>

	</body>
</html>
